<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inst칛llningar - EV Smart Charger</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .nav-bottom {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex; justify-content: space-around; padding: 10px;
            z-index: 1000;
        }
        .nav-item { text-align: center; color: #6c757d; text-decoration: none; font-size: 12px; }
        .nav-item.active { color: #0d6efd; font-weight: bold; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }
        .content { padding-bottom: 80px; max-width: 600px; margin: 0 auto; }
        input[type=range] { width: 100%; }
    </style>
</head>
<body>

<div class="container mt-4 content">
    <h4 class="mb-4 fw-bold text-center">丘뙖잺 Inst칛llningar</h4>

    <!-- Charge Targets -->
    <div class="card p-4">
        <h5 class="mb-4">游뚱 Laddm친l</h5>
        
        <div class="mb-4">
            <label class="form-label d-flex justify-content-between">
                <span>Mercedes EQV (M친l)</span>
                <span id="merc-val" class="fw-bold">80%</span>
            </label>
            <input type="range" class="form-range" min="20" max="100" step="5" id="mercedes_target" oninput="updateVal('merc-val', this.value)">
        </div>

        <div class="mb-3">
            <label class="form-label d-flex justify-content-between">
                <span>Nissan Leaf (M친l)</span>
                <span id="leaf-val" class="fw-bold">80%</span>
            </label>
            <input type="range" class="form-range" min="20" max="100" step="5" id="nissan_target" oninput="updateVal('leaf-val', this.value)">
        </div>
    </div>
    
    <!-- Departure -->
    <div class="card p-4">
        <h5 class="mb-3">游 Avresa</h5>
        <p class="text-muted small">Bilarna ska vara klara senast denna tid.</p>
        <input type="time" class="form-control form-control-lg" id="departure_time">
    </div>

    <!-- Home Assistant Config -->
    <div class="card p-4">
        <h5 class="mb-3">游 Home Assistant Integration</h5>
        <div class="mb-2">
            <label class="small text-muted">Home Assistant URL (inkl. port)</label>
            <input type="text" class="form-control" id="ha_url" value="http://100.100.118.62:8123">
        </div>
        <div class="mb-2">
            <label class="small text-muted">Long-Lived Access Token</label>
            <input type="password" class="form-control" id="ha_token">
        </div>
        <div class="mb-3">
            <label class="small text-muted">Mercedes EQV SoC Entitets ID</label>
            <input type="text" class="form-control" id="ha_merc_soc_entity_id" placeholder="sensor.mercedes_eqv_battery_level">
        </div>
        <div class="small text-muted mt-2">H칛mtar Mercedes batteristatus fr친n HA.</div>
    </div>
    
    <div class="d-grid">
        <button class="btn btn-primary btn-lg" onclick="saveSettings()">Spara 칛ndringar</button>
    </div>
    
    <div id="toast" class="toast align-items-center text-white bg-success border-0 position-fixed top-0 start-50 translate-middle-x mt-3" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          Inst칛llningar sparade!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>

</div>

<nav class="nav-bottom">
    <a href="/" class="nav-item">
        <i class="bi bi-lightning-charge-fill"></i>
        Ladda
    </a>
    <a href="/planning" class="nav-item">
        <i class="bi bi-calendar-check-fill"></i>
        Plan
    </a>
    <a href="/settings" class="nav-item active">
        <i class="bi bi-gear-fill"></i>
        Inst칛llningar
    </a>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function updateVal(id, val) {
        document.getElementById(id).innerText = val + '%';
    }

    // Load Settings
    fetch('/api/settings')
        .then(res => res.json())
        .then(data => {
            document.getElementById('mercedes_target').value = data.mercedes_target || 80;
            updateVal('merc-val', data.mercedes_target || 80);
            
            document.getElementById('nissan_target').value = data.nissan_target || 80;
            updateVal('leaf-val', data.nissan_target || 80);
            
            document.getElementById('departure_time').value = data.departure_time || "07:00";
            
            document.getElementById('ha_url').value = data.ha_url || "http://100.100.118.62:8123";
            document.getElementById('ha_token').value = data.ha_token || "";
            document.getElementById('ha_merc_soc_entity_id').value = data.ha_merc_soc_entity_id || "";
        });

    function saveSettings() {
        const data = {
            mercedes_target: parseInt(document.getElementById('mercedes_target').value),
            nissan_target: parseInt(document.getElementById('nissan_target').value),
            departure_time: document.getElementById('departure_time').value,
            ha_url: document.getElementById('ha_url').value,
            ha_token: document.getElementById('ha_token').value,
            ha_merc_soc_entity_id: document.getElementById('ha_merc_soc_entity_id').value
        };

        fetch('/api/settings', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(() => {
            const toast = new bootstrap.Toast(document.getElementById('toast'));
            toast.show();
        });
    }
</script>

</body>
</html>